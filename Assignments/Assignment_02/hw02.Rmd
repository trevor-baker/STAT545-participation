---
title: "Assignment 2"
author: "Trevor Baker"
date: "19/09/2019"
output: 
  html_document:
    keep_md: true
---

```{r setup, include=FALSE, message=F}

library(gapminder)
library(tidyverse)
library(ggplot2)
library(knitr)
library(DT)

```



## EXERCISE 1
#### Basic 'dplyr'

__1.1__
```{r 1_1}
knitr::kable(
  gapminder %>%
    filter(between(year,1970,1980) & (country=="China" | country=="Canada" | country=="United States"))
)
```


__1.2__
```{r 1_2}
knitr::kable(
  gapminder %>%
    filter(between(year,1970,1980) & (country=="China" | country=="Canada" | country=="United States")) %>%
    select(country, gdpPercap)
)
```


__1.3__
```{r 1_3}

DT::datatable(
  gapminder %>%
    group_by(country) %>%
    mutate(lifeExp.incr=lifeExp-lag(lifeExp) ) %>%
    filter(lifeExp.incr<0)
)
```

__1.4__
```{r 1_4}

DT::datatable(
  gapminder %>%
    group_by(country) %>%
    summarize(max.gdp=max(gdpPercap))
)
```


__1.5__
```{r}

gapminder %>%
  filter(country=="Canada") %>%
  ggplot(aes(x=gdpPercap,y=lifeExp)) + 
            geom_point() +
            scale_x_log10("GDP per capita", labels = scales::dollar_format()) +
            ylab("Life expectancy") +
            ggtitle("Canada's life expectancy vs per capita GDP") +
            theme_bw()

```

---

## EXERCISE 2
#### Explore individal variables with 'dplyr'

I have chosen life expectancy and continent to summarize here.

There are 5 continents in the dataset:
```{r unique_cont}
#display all continents - kind of useles
knitr::kable(
  gapminder %>%
    select(continent) %>%
    unique()
)
```


Here are some summary stats on global life expectancies:
```{r global_le_table}
#display range of lifeExp data by continent
knitr::kable(
  gapminder %>%
    select(lifeExp) %>%
    summarize(min.lifeExp=min(lifeExp)%>% round(digits=1),
              median.lifeExp=median(lifeExp)%>% round(digits=1),
              mean.lifeExp=mean(lifeExp)%>% round(digits=1),
              max.lifeExp=max(lifeExp) %>% round(digits=1)) 
)
```

It is more informative to see these summary statistics divided up by continent:
```{r cont_le_table}
#display range of lifeExp data by continent
knitr::kable(
  gapminder %>%
    select(continent, lifeExp) %>%
    group_by(continent) %>%
    summarize(min.lifeExp=min(lifeExp)%>% round(digits=1),
              median.lifeExp=median(lifeExp)%>% round(digits=1),
              mean.lifeExp=mean(lifeExp)%>% round(digits=1),
              max.lifeExp=max(lifeExp) %>% round(digits=1)) 
)
```


It's probably even more informative to see them graphed:
```{r cont_le_boxplot}

#display range of both variables via boxplot
gapminder %>%
  select(continent, lifeExp) %>%
  group_by(continent) %>%
  ggplot(aes(x=continent, y=lifeExp)) +
    geom_boxplot(notch=T) +
    ylab("Life Expectancy") +
    xlab("Continent") +
    theme_bw()

```

---

## EXERCISE 3
#### Explore various plot types

__Plot 1__

```{r ex3_plot1}

gapminder %>%
  ggplot(aes(x=pop, y=lifeExp, size=gdpPercap, fill=continent)) +
    geom_point(pch=21,colour="black") +
    scale_x_log10("Population", labels=scales::comma) +
    ylab("Life expectancy") +
    theme_bw() +
    scale_size_continuous(name="GDP per capita (US $, infl. adj.)", range=c(0.5,10)) +
    scale_fill_discrete(name="Continent") +
    guides(fill = guide_legend(override.aes = list(size=8)))


```

__Plot 2__
```{r ex3_plot2}

gapminder %>%
  mutate(gdp=gdpPercap*pop) %>%
  mutate(continent=factor(continent, #put small ones on top
                          levels=c("Africa","Oceania","Americas","Europe","Asia"))) %>%
  group_by(continent, year) %>%
  summarize(gdp.cont=sum(gdp)/1e9) %>%
  ggplot(aes(x=year, y=gdp.cont, fill=continent)) +
    geom_col() +
    scale_fill_brewer(palette="YlGn", 
                      name="Continent") +
    scale_y_continuous(name="GDP, billions US $") +
    scale_x_continuous(name="Year") +
    labs(title="Growth in global GDP from 1952 to 2007")


```


